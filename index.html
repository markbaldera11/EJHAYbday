<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday Ejhay!</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --primary: #ff6b6b; --secondary: #feca57; --bg: #f7f1e3; }
        body { margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; background: var(--bg); font-family: 'Segoe UI', sans-serif; text-align: center; overflow-x: hidden; }
        
        .hero { padding: 40px 20px; z-index: 10; }
        h1 { color: var(--primary); font-size: 3.2rem; margin: 0; text-shadow: 2px 2px #fff; }
        
        /* Cake Animation */
        .cake-container { cursor: pointer; margin: 30px auto; position: relative; width: 150px; z-index: 10; }
        .cake { width: 150px; height: 80px; background: #6d4c41; border-radius: 10px 10px 0 0; position: relative; }
        .frosting { width: 150px; height: 30px; background: #f06292; border-radius: 10px 10px 20px 20px; position: absolute; top: 0; }
        .candle { width: 10px; height: 35px; background: var(--secondary); position: absolute; top: -35px; left: 70px; border-radius: 2px; }
        .flame { width: 15px; height: 20px; background: orange; position: absolute; top: -20px; left: -2.5px; border-radius: 50% 50% 20% 20%; animation: flicker 0.1s infinite alternate; }
        @keyframes flicker { from { transform: scale(1); } to { transform: scale(1.1); } }
        
        /* Form & Message Board Styling */
        .container { 
            background: white; padding: 30px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            width: 85%; max-width: 450px; margin-bottom: 40px; z-index: 20;
        }
        textarea { width: 100%; padding: 15px; margin: 15px 0; border: 2px solid #eee; border-radius: 12px; box-sizing: border-box; font-size: 1rem; resize: none; }
        textarea:focus { border-color: var(--primary); outline: none; }
        
        button { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 12px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1.1rem; transition: 0.3s; margin-bottom: 10px; }
        button:hover { background: #ee5253; transform: scale(1.02); }
        button:disabled { background: #ccc; cursor: not-allowed; }

        /* Message Cards */
        #message-board { margin-top: 30px; display: flex; flex-direction: column; gap: 15px; max-height: 400px; overflow-y: auto; padding-right: 5px; }
        .message-card { background: #fff9c4; padding: 15px; border-radius: 10px; box-shadow: 2px 2px 8px rgba(0,0,0,0.05); text-align: left; font-size: 1.05rem; color: #333; border-left: 5px solid var(--secondary); animation: popIn 0.4s ease; }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .loading { color: #888; font-style: italic; }

        .hidden { display: none; }
        .balloon { position: absolute; bottom: -100px; width: 45px; height: 65px; border-radius: 50%; opacity: 0.5; z-index: 1; animation: float 12s infinite linear; }
        @keyframes float { 0% { transform: translateY(0); } 100% { transform: translateY(-130vh); } }
    </style>
</head>
<body>

    <div id="balloons"></div>

    <div class="hero">
        <h1>Happy 25th Birth-Day Ejhay ðŸŽ‚</h1>
        <p>Tap the candle to start the party!</p>
        
        <div class="cake-container" onclick="blowCandle()">
            <div class="candle"><div class="flame" id="flame"></div></div>
            <div class="cake"><div class="frosting"></div></div>
        </div>
    </div>

    <div class="container">
        <h3>Leave a Message</h3>
        <form id="msgForm">
            <textarea id="message" rows="3" placeholder="Type your birthday wish here..." required></textarea>
            <button type="submit" id="submitBtn">Sendâœ¨</button>
        </form>
        <p id="status" style="margin-top: 5px; font-weight: bold; color: #2ecc71;"></p>

        <hr style="border: 1px solid #eee; margin: 25px 0;">

        <h3>Birthday Wishes ðŸ’Œ</h3>
        <div id="message-board">
            <div class="loading">Loading messages...</div>
        </div>
    </div>

    <script>
        // REPLACE THIS WITH YOUR NEW WEB APP URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyJ6ZgCEgm6MtSpxip2ylxpgGDSA79IayqDat9mEHECVWSlgBG1ZHu17TsEkRbdPCU9tA/exec'; 

        function blowCandle() {
            const flame = document.getElementById('flame');
            if(!flame.classList.contains('hidden')) {
                flame.classList.add('hidden');
                confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
            }
        }

        // Fetch messages on page load
        function loadMessages() {
            fetch(SCRIPT_URL)
                .then(response => response.json())
                .then(data => {
                    const board = document.getElementById('message-board');
                    board.innerHTML = ''; // Clear loading text
                    
                    if(data.length === 0) {
                        board.innerHTML = '<div class="loading">No messages yet. Be the first!</div>';
                        return;
                    }

                    // Reverse the array so the newest messages are at the top
                    data.reverse().forEach(msg => {
                        addMessageToBoard(msg);
                    });
                })
                .catch(error => {
                    document.getElementById('message-board').innerHTML = '<div class="loading" style="color:red;">Failed to load messages.</div>';
                });
        }

        function addMessageToBoard(msgText) {
            const board = document.getElementById('message-board');
            const card = document.createElement('div');
            card.className = 'message-card';
            card.innerText = msgText;
            // Add to the top of the list
            board.insertBefore(card, board.firstChild); 
        }

        // Handle form submission
        document.getElementById('msgForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const status = document.getElementById('status');
            const msg = document.getElementById('message').value;
            
            btn.disabled = true;
            btn.innerText = "Sending...";

            // Send to Google Sheets
            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({ message: msg })
            }).then(() => {
                status.innerText = "Sent! ðŸ’–";
                btn.innerText = "Message Delivered!";
                document.getElementById('msgForm').reset();
                
                // Immediately display the new message on the board without refreshing
                const emptyState = document.querySelector('.loading');
                if(emptyState) emptyState.remove();
                addMessageToBoard(msg);

                // Reset button after 3 seconds
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerText = "Send Another Wish âœ¨";
                    status.innerText = "";
                }, 3000);

            }).catch(err => {
                status.innerText = "Oops! Try again.";
                btn.disabled = false;
                btn.innerText = "Send to Ejhay âœ¨";
            });
        });

        // Start loading messages right away
        loadMessages();

        // Balloon Generator
        const colors = ['#ff6b6b','#feca57','#48dbfb','#1dd1a1','#ff9ff3'];
        for(let i=0; i<20; i++) {
            const b = document.createElement('div');
            b.className = 'balloon';
            b.style.left = Math.random() * 100 + 'vw';
            b.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
            b.style.animationDelay = (Math.random() * 8) + 's';
            document.getElementById('balloons').appendChild(b);
        }
    </script>
</body>
</html>
